---
title: 输入url到展示的过程
tags:
  - javascript
categories: js常见问题
date: 2019-02-26 10:04:21
---

作为前端工程师，我们日常打交道的就是浏览器了，可是你想过当你输入url回车到页面展示的这一个过程都发生了什么吗？


### 浏览器渲染之前主要有如下几步：
- 浏览器根据DNS域名服务器得到域名对应的公网ip
- 浏览器对这个ip发送http请求
- 服务器接受、处理http请求，并响应
- 浏览器收到服务器响应的内容并解析

- DNS解析：DNS服务器对url进行一对一的ip映射解析 
- TCP三次握手：解析完后，就是服务器和浏览器的交互，交互之前就需要创建连接，我们知道tcp协议是全双工传输，需要浏览器和服务端都可以传输数据，都需要确认对方可以接收到，所以需要三次握手 
  * ACK表示消息收到
  * syn表示请求创建连接
  * FIN表示请求关闭连接
- TCP四次挥手：而连接的关闭需要四次，需要双方都确认关闭
- 发送请求，分析 url，设置请求报文(头，主体)
- 服务器返回请求的文件 (html)
- 浏览器进行渲染
  * HTML parser --> DOM Tree
    + 标记化算法，进行元素状态的标记
    + dom树构建
  * css parser  --> Style Tree
    + 解析 css 代码，生成样式树
  * 集合 -->  Render树
    + 结合dom树和样式树，生成渲染树
  * layout 根据渲染树布局
  * Gup 绘制：根据样式进行页面绘制

- 解析dom遇到js代码的过程：因为dom解析和js执行是两个引擎完成，为防止渲染发生不可预知的错误，js引擎和渲染引擎是互斥的，所以会阻断dom解析
  * 阻断dom解析
  * 下载并执行js
  * 继续dom解析

- 执行的js操作cssDom的情况：
 * 阻断dom
 * 执行js(操作css)
 * 下载css并解析cssDom
 * 执行js
 * 继续dom解析